{"version":3,"file":"index.browser.min.js","sources":["../../../node_modules/auto-bind/index.js","../src/index.ts"],"sourcesContent":["'use strict';\n\n// Gets all non-builtin properties up the prototype chain\nconst getAllProperties = object => {\n\tconst properties = new Set();\n\n\tdo {\n\t\tfor (const key of Reflect.ownKeys(object)) {\n\t\t\tproperties.add([object, key]);\n\t\t}\n\t} while ((object = Reflect.getPrototypeOf(object)) && object !== Object.prototype);\n\n\treturn properties;\n};\n\nmodule.exports = (self, {include, exclude} = {}) => {\n\tconst filter = key => {\n\t\tconst match = pattern => typeof pattern === 'string' ? key === pattern : pattern.test(key);\n\n\t\tif (include) {\n\t\t\treturn include.some(match);\n\t\t}\n\n\t\tif (exclude) {\n\t\t\treturn !exclude.some(match);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tfor (const [object, key] of getAllProperties(self.constructor.prototype)) {\n\t\tif (key === 'constructor' || !filter(key)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(object, key);\n\t\tif (descriptor && typeof descriptor.value === 'function') {\n\t\t\tself[key] = self[key].bind(self);\n\t\t}\n\t}\n\n\treturn self;\n};\n","import autoBind from \"auto-bind\";\nimport { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"sketchpad\",\n  parameters: {\n    image: {\n      type: ParameterType.IMAGE,\n      default: undefined,\n    },\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * **image-text-annotaiton**\n *\n * jsPsych plugin for annotating an image with text labels\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/image-text-annotation/ image-text-annotation plugin documentation on jspsych.org}\n */\nclass ImageTextAnnotationPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n  private img_container: HTMLElement;\n  private is_drawing = false;\n  private active_box: AnnotationBox;\n  private active_label: string;\n  private boxes: Array<AnnotationBox> = [];\n  private display_element: HTMLElement;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    this.display_element = display_element;\n\n    this.add_css();\n    this.renderDisplay(trial);\n    this.addEvents(trial);\n  }\n\n  private renderDisplay(trial) {\n    let html = `<div id=\"jspsych-annotation-display\">`;\n    if (trial.prompt !== null) {\n      html += `<div id='instructions'>${trial.prompt}</div>`;\n    }\n    html += `\n      <div id='main-display'>\n        <div id='annotated-image-container'>\n          <img src=\"${trial.image}\" draggable=\"false\"></img>\n        </div>\n        <div id='annotation-options'>\n          <div><input type=\"radio\" id=\"opt1\" name=\"annotate_label\" value=\"foo\"><label for=\"opt1\">Foo</label></div>\n          <div><input type=\"radio\" id=\"opt2\" name=\"annotate_label\" value=\"bar\"><label for=\"opt2\">Bar</label></div>\n          <div><input type=\"radio\" id=\"opt3\" name=\"annotate_label\" value=\"\"><label for=\"opt3\"><input id=\"opt3_text\" type=\"text\"></label></div>\n        </div>\n      </div>\n    `;\n    html += `</div>`;\n\n    this.display_element.innerHTML = html;\n\n    this.img_container = this.display_element.querySelector(\"#annotated-image-container\");\n  }\n\n  private addEvents(trial) {\n    this.img_container.addEventListener(\"mousedown\", this.start_box);\n\n    const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n    for (const r of Array.from(radios)) {\n      r.addEventListener(\"change\", this.handle_radio_change);\n    }\n\n    this.img_container.addEventListener(\"mousemove\", this.sort_boxes);\n\n    document.addEventListener(\"click\", this.deselect_all);\n\n    this.display_element.querySelector('input[type=\"text\"]').addEventListener('change', this.add_new_label);\n    this.display_element.querySelector('input[type=\"text\"]').addEventListener('change', this.update_labels);\n  }\n\n  private add_css() {\n    document.querySelector(\"head\").insertAdjacentHTML(\n      \"beforeend\",\n      `<style id=\"image-text-annotation-styles\">\n        #jspsych-annotation-display #main-display {\n          display: flex;\n        }\n\n        #jspsych-annotation-display #annotated-image-container {\n          cursor: crosshair;\n          position: relative;\n        }\n\n        #jspsych-annotation-display #annotated-image-container img {\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box {\n          border: 1px solid green;\n          position: absolute;\n          color:green;\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover {\n          border: 1px solid yellow;\n          color:yellow;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label {\n          font-size:10px;\n          font-family:monospace;\n          text-align:left;\n          line-height:1em;\n          background-color: rgba(255,255,255,0.5);\n          border-radius: 5px;\n          border: 1px solid green;\n          position:absolute;\n          top:50%;\n          left:50%;\n          transform: translate(-50%,-50%);\n          padding: 0.25em;\n          user-select: none;\n          cursor: pointer;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label.selected {\n          font-size:10px;\n          font-family:monospace;\n          text-align:left;\n          line-height:1em;\n          background-color: rgba(255,255,255,0.5);\n          border-radius: 5px;\n          border: 1px solid red;\n          color: red;\n          position:absolute;\n          top:50%;\n          left:50%;\n          transform: translate(-50%,-50%);\n          padding: 0.25em;\n          user-select: none;\n          cursor: pointer;\n        }\n\n        .annotation-box-remove {\n          visibility: hidden;\n          user-select: none;\n          font-size:15px;\n          font-family:monospace;\n          margin:0px;\n          text-align:left;\n          line-height:1em;\n          position: absolute;\n          top:0;\n          right:0;\n          background-color: green;\n          color: white;\n          width:1em;\n          height:1em;\n          text-align: center;\n          cursor: pointer;\n        }\n\n        .annotation-box-resize {\n          visibility: hidden;\n          width: 6px;\n          height: 6px;\n          border-radius: 3px;\n          background-color: green;\n          border: 1px solid white;\n          position: absolute;\n          cursor: pointer;\n          user-select: none;\n        }\n\n        .annotation-box .left {\n          left: -4px;\n        }\n\n        .annotation-box .top {\n          top: -4px;\n        }\n\n        .annotation-box .right {\n          right: -4px;\n        }\n\n        .annotation-box .bottom {\n          bottom: -4px;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover .annotation-box-remove {\n          visibility: visible;\n          \n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover .annotation-box-resize {\n          visibility: visible;\n        }\n\n        #jspsych-annotation-display #annotation-options {\n          text-align: left;\n          padding-left: 24px;\n        }\n      </style>`\n    );\n  }\n\n  private start_box(e) {\n    const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n    this.is_drawing = true;\n\n    this.active_box = new AnnotationBox(x, y, this.boxes, this.img_container, this);\n\n    this.img_container.appendChild(this.active_box.getElement());\n\n    this.img_container.addEventListener(\"mousemove\", this.move_box);\n    this.img_container.addEventListener(\"mouseup\", this.stop_box);\n  }\n\n  private move_box(e) {\n    if (this.is_drawing) {\n      const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n      const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n      this.active_box.setEndCoords(x, y);\n    }\n  }\n\n  private stop_box() {\n    if (this.is_drawing) {\n      this.active_box.finishDrawing();\n\n      this.active_box.setLabel(this.active_label);\n\n      this.active_box = null;\n      this.img_container.removeEventListener(\"mousemove\", this.move_box);\n\n      this.is_drawing = false;\n    }\n  }\n\n  private sort_boxes() {\n    const original_order = this.boxes.map((box) => box.area());\n    const sizes = this.boxes.map((box) => box.area());\n    sizes.sort((a, b) => b - a);\n\n    let z = 0;\n    for (const s of sizes) {\n      this.boxes[original_order.indexOf(s)].setZIndex(z.toString());\n      z++;\n    }\n  }\n\n  select_label(label: string) {\n    const radio: HTMLFormElement = this.display_element.querySelector(`input[value='${label}']`);\n    if (radio) {\n      radio.checked = true;\n    } else {\n      const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n      for (const r of Array.from(radios)) {\n        (r as HTMLFormElement).checked = false;\n      }\n    }\n  }\n\n  private handle_radio_change(e) {\n    this.active_label = (e.target as HTMLFormElement).value;\n    for (const b of this.boxes) {\n      if (b.isSelected()) {\n        b.setLabel(this.active_label);\n      }\n    }\n  }\n\n  private deselect_all(e) {\n    if (![\"RADIO\", \"LABEL\", \"INPUT\"].includes(e.target.tagName)) {\n      for (const b of this.boxes) {\n        b.deselect();\n      }\n    }\n  }\n\n  private add_new_label(e){\n    const container = this.display_element.querySelector('#annotation-options');\n    const options = container.querySelectorAll('input[type=\"radio\"]').length;\n    const html = `\n      <div><input type=\"radio\" id=\"opt${options+1}\" name=\"annotate_label\" value=\"\"><label for=\"${options+1}\"><input id=\"opt${options+1}_text\" type=\"text\"></label></div>\n    `\n    container.insertAdjacentHTML('beforeend', html);\n    container.querySelector(`#opt${options+1}_text`).addEventListener('change', this.add_new_label);\n    container.querySelector(`#opt${options+1}_text`).addEventListener('change', this.update_labels);\n    e.target.removeEventListener('change', this.add_new_label);\n\n    container.querySelector(`#opt${options+1}`).addEventListener(\"change\", this.handle_radio_change);\n  }\n\n  private update_labels(e){\n    const text = e.target as HTMLFormElement;\n    const radio = text.parentElement.parentElement.querySelector('input[type=\"radio\"]') as HTMLFormElement;\n\n    const old_label = radio.value;\n    const new_label = text.value;\n\n    for(const b of this.boxes){\n      if(b.getLabel() == old_label){\n        b.setLabel(new_label);\n      }\n    }\n\n    radio.value = new_label;\n  }\n}\n\nclass AnnotationBox {\n  private label = \"?\";\n  private element: HTMLElement;\n  private start_x;\n  private start_y;\n  private end_x;\n  private end_y;\n  private box_list: Array<AnnotationBox>;\n  private container: HTMLElement;\n  private selected = false;\n  private plugin: ImageTextAnnotationPlugin;\n\n  constructor(x, y, box_list, container, plugin) {\n    autoBind(this);\n\n    this.container = container;\n    this.box_list = box_list;\n    this.plugin = plugin;\n\n    this.setAnchorCoords(x, y);\n\n    const el = document.createElement(\"div\");\n    el.setAttribute(\"class\", \"annotation-box\");\n    el.style.left = `${x}px`;\n    el.style.top = `${y}px`;\n\n    this.element = el;\n  }\n\n  setLabel(label) {\n    if (label) {\n      this.label = label;\n    }\n    this.element.querySelector(\".annotation-box-label\").innerHTML = this.label;\n  }\n\n  getLabel() {\n    return this.label;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  setAnchorCoords(x, y) {\n    this.start_x = x;\n    this.start_y = y;\n  }\n\n  setEndCoords(x, y) {\n    this.end_x = x;\n    this.end_y = y;\n\n    this.element.style.width = `${Math.abs(this.end_x - this.start_x)}px`;\n    this.element.style.height = `${Math.abs(this.end_y - this.start_y)}px`;\n\n    if (this.start_x <= this.end_x) {\n      this.element.style.left = `${this.start_x}px`;\n    } else {\n      this.element.style.left = `${this.end_x}px`;\n    }\n\n    if (this.start_y <= this.end_y) {\n      this.element.style.top = `${this.start_y}px`;\n    } else {\n      this.element.style.top = `${this.end_y}px`;\n    }\n  }\n\n  finishDrawing() {\n    this.element.innerHTML = `\n      <span class=\"annotation-box-label\"></span>\n      <span class=\"annotation-box-remove\">X</span>\n      <div class=\"annotation-box-resize top left\"></div>\n      <div class=\"annotation-box-resize top right\"></div>\n      <div class=\"annotation-box-resize bottom left\"></div>\n      <div class=\"annotation-box-resize bottom right\"></div>\n    `;\n\n    this.box_list.push(this);\n\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mousedown\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mouseup\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      this.remove();\n    });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.container.addEventListener(\"mouseup\", () => {\n      this.stopMove();\n    });\n\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"click\", this.select);\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"mousedown\", (e) => {\n      e.stopPropagation();\n    });\n  }\n\n  startMove() {\n    this.container.addEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  moveHandler(e) {\n    const x = Math.round(e.clientX - this.container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.container.getBoundingClientRect().top);\n\n    this.setEndCoords(x, y);\n  }\n\n  stopMove() {\n    this.container.removeEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  area() {\n    const { width, height } = this.element.getBoundingClientRect();\n    return width * height;\n  }\n\n  setZIndex(z: string) {\n    this.element.style.zIndex = z;\n  }\n\n  remove() {\n    this.element.remove();\n    this.box_list = this.box_list.filter((x) => {\n      x !== this;\n    });\n  }\n\n  select(e: Event) {\n    e.stopPropagation();\n    for (const b of this.box_list) {\n      b.deselect();\n    }\n    this.selected = true;\n    this.element.querySelector(\".annotation-box-label\").classList.add(\"selected\");\n    this.plugin.select_label(this.label);\n  }\n\n  deselect() {\n    this.selected = false;\n    this.element.querySelector(\".annotation-box-label\").classList.remove(\"selected\");\n  }\n\n  isSelected() {\n    return this.selected;\n  }\n\n  showResizeHandles() {\n    const handles = this.element.querySelectorAll(\".annotation-box-resize\");\n    // for(const h of handles){\n    //   h.style.visibility = 'visible';\n    // }\n  }\n}\n\nexport default ImageTextAnnotationPlugin;\n"],"names":["getAllProperties","object","properties","Set","Reflect","ownKeys","key","add","getPrototypeOf","Object","prototype","info","name","parameters","image","type","ParameterType","IMAGE","default","undefined","prompt","HTML_STRING","ImageTextAnnotationPlugin","constructor","jsPsych","this","trial","display_element","add_css","renderDisplay","addEvents","html","innerHTML","img_container","querySelector","addEventListener","start_box","radios","querySelectorAll","r","Array","from","handle_radio_change","sort_boxes","document","deselect_all","add_new_label","update_labels","insertAdjacentHTML","e","x","Math","round","clientX","getBoundingClientRect","left","y","clientY","top","is_drawing","active_box","AnnotationBox","boxes","appendChild","getElement","move_box","stop_box","setEndCoords","finishDrawing","setLabel","active_label","removeEventListener","original_order","map","box","area","sizes","sort","a","b","z","s","indexOf","setZIndex","toString","select_label","label","radio","checked","target","value","isSelected","includes","tagName","deselect","container","options","length","text","parentElement","old_label","new_label","getLabel","box_list","plugin","self","include","exclude","filter","match","pattern","test","some","descriptor","getOwnPropertyDescriptor","bind","autoBind","setAnchorCoords","el","createElement","setAttribute","style","element","start_x","start_y","end_x","end_y","width","abs","height","push","stopPropagation","preventDefault","remove","coords","startMove","right","bottom","stopMove","select","moveHandler","zIndex","selected","classList","showResizeHandles"],"mappings":"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"}
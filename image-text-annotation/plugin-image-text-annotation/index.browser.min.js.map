{"version":3,"file":"index.browser.min.js","sources":["../../../node_modules/auto-bind/index.js","../src/index.ts"],"sourcesContent":["'use strict';\n\n// Gets all non-builtin properties up the prototype chain\nconst getAllProperties = object => {\n\tconst properties = new Set();\n\n\tdo {\n\t\tfor (const key of Reflect.ownKeys(object)) {\n\t\t\tproperties.add([object, key]);\n\t\t}\n\t} while ((object = Reflect.getPrototypeOf(object)) && object !== Object.prototype);\n\n\treturn properties;\n};\n\nmodule.exports = (self, {include, exclude} = {}) => {\n\tconst filter = key => {\n\t\tconst match = pattern => typeof pattern === 'string' ? key === pattern : pattern.test(key);\n\n\t\tif (include) {\n\t\t\treturn include.some(match);\n\t\t}\n\n\t\tif (exclude) {\n\t\t\treturn !exclude.some(match);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tfor (const [object, key] of getAllProperties(self.constructor.prototype)) {\n\t\tif (key === 'constructor' || !filter(key)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(object, key);\n\t\tif (descriptor && typeof descriptor.value === 'function') {\n\t\t\tself[key] = self[key].bind(self);\n\t\t}\n\t}\n\n\treturn self;\n};\n","import autoBind from \"auto-bind\";\nimport { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"sketchpad\",\n  parameters: {\n    image: {\n      type: ParameterType.IMAGE,\n      default: undefined,\n    },\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n    regions: {\n      type: ParameterType.COMPLEX,\n      default: [],\n      array: true,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * **image-text-annotaiton**\n *\n * jsPsych plugin for annotating an image with text labels\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/image-text-annotation/ image-text-annotation plugin documentation on jspsych.org}\n */\nclass ImageTextAnnotationPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n  private img_container: HTMLElement;\n  private is_drawing = false;\n  private active_box: AnnotationBox;\n  private active_label: string;\n  private boxes: Array<AnnotationBox> = [];\n  private display_element: HTMLElement;\n  private deselect_all_flag = true;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    this.display_element = display_element;\n\n    this.add_css();\n    this.renderDisplay(trial);\n    this.addEvents(trial);\n\n    for (const roi of trial.regions) {\n      const box = new AnnotationBox(roi.left, roi.top, this.boxes, this.img_container, this);\n      box.setEndCoords(roi.right, roi.bottom);\n      box.finishDrawing();\n      box.setLabel(roi.label ? roi.label : \"?\");\n      box.setModifiable(false);\n    }\n  }\n\n  private renderDisplay(trial) {\n    let html = `<div id=\"jspsych-annotation-display\">`;\n    if (trial.prompt !== null) {\n      html += `<div id='instructions'>${trial.prompt}</div>`;\n    }\n    html += `\n      <div id='main-display'>\n        <div id='annotated-image-container'>\n          <img src=\"${trial.image}\" draggable=\"false\"></img>\n        </div>\n        <div id='annotation-options'>\n          <div><input type=\"radio\" id=\"opt1\" name=\"annotate_label\" value=\"Foo\"><label for=\"opt1\">Foo</label></div>\n          <div><input type=\"radio\" id=\"opt2\" name=\"annotate_label\" value=\"Bar\"><label for=\"opt2\">Bar</label></div>\n          <div><input type=\"radio\" id=\"opt3\" name=\"annotate_label\" value=\"\"><label for=\"opt3\"><input id=\"opt3_text\" type=\"text\"></label></div>\n        </div>\n      </div>\n    `;\n    html += `</div>`;\n\n    this.display_element.innerHTML = html;\n\n    this.img_container = this.display_element.querySelector(\"#annotated-image-container\");\n  }\n\n  private addEvents(trial) {\n    this.img_container.addEventListener(\"mousedown\", this.start_box);\n\n    const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n    for (const r of Array.from(radios)) {\n      r.addEventListener(\"change\", this.handle_radio_change);\n    }\n\n    this.img_container.addEventListener(\"mousemove\", this.sort_boxes);\n\n    document.addEventListener(\"mousedown\", () => {\n      this.deselect_all_flag = true;\n    });\n    document.addEventListener(\"click\", this.deselect_all);\n\n    this.display_element\n      .querySelector('input[type=\"text\"]')\n      .addEventListener(\"change\", this.add_new_label);\n    this.display_element\n      .querySelector('input[type=\"text\"]')\n      .addEventListener(\"change\", this.update_labels);\n  }\n\n  private add_css() {\n    document.querySelector(\"head\").insertAdjacentHTML(\n      \"beforeend\",\n      `<style id=\"image-text-annotation-styles\">\n        #jspsych-annotation-display #main-display {\n          display: flex;\n        }\n\n        #jspsych-annotation-display #annotated-image-container {\n          cursor: crosshair;\n          position: relative;\n        }\n\n        #jspsych-annotation-display #annotated-image-container img {\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box {\n          border: 1px solid green;\n          position: absolute;\n          color:green;\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover {\n          border: 1px solid yellow;\n          color:yellow;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label {\n          font-size:10px;\n          font-family:monospace;\n          text-align:left;\n          line-height:1em;\n          background-color: rgba(255,255,255,0.5);\n          border-radius: 5px;\n          border: 1px solid rgba(255,255,255,0.5);\n          position:absolute;\n          top:2px;\n          left:2px;\n          padding: 0.25em;\n          user-select: none;\n          cursor: pointer;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label.selected {\n          border: 1px solid red;\n          color: red;\n        }\n\n        .annotation-box-remove {\n          visibility: hidden;\n          user-select: none;\n          font-size:15px;\n          font-family:monospace;\n          margin:0px;\n          text-align:left;\n          line-height:1em;\n          position: absolute;\n          top:0;\n          right:0;\n          background-color: green;\n          color: white;\n          width:1em;\n          height:1em;\n          text-align: center;\n          cursor: pointer;\n        }\n\n        .annotation-box-resize {\n          visibility: hidden;\n          width: 6px;\n          height: 6px;\n          border-radius: 3px;\n          background-color: green;\n          border: 1px solid white;\n          position: absolute;\n          cursor: pointer;\n          user-select: none;\n        }\n\n        .annotation-box .left {\n          left: -4px;\n        }\n\n        .annotation-box .top {\n          top: -4px;\n        }\n\n        .annotation-box .right {\n          right: -4px;\n        }\n\n        .annotation-box .bottom {\n          bottom: -4px;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box.modifiable:hover .annotation-box-remove {\n          visibility: visible;\n          \n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box.modifiable:hover .annotation-box-resize {\n          visibility: visible;\n        }\n\n        #jspsych-annotation-display #annotation-options {\n          text-align: left;\n          padding-left: 24px;\n        }\n      </style>`\n    );\n  }\n\n  private start_box(e) {\n    const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n    this.is_drawing = true;\n\n    this.active_box = new AnnotationBox(x, y, this.boxes, this.img_container, this);\n\n    this.img_container.addEventListener(\"mousemove\", this.move_box);\n    this.img_container.addEventListener(\"mouseup\", this.stop_box);\n  }\n\n  private move_box(e) {\n    if (this.is_drawing) {\n      const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n      const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n      this.active_box.setEndCoords(x, y);\n    }\n  }\n\n  private stop_box() {\n    if (this.is_drawing) {\n      this.active_box.finishDrawing();\n\n      this.active_box.setLabel(this.active_label);\n\n      this.active_box.select();\n\n      this.active_box = null;\n      this.img_container.removeEventListener(\"mousemove\", this.move_box);\n\n      this.is_drawing = false;\n      this.deselect_all_flag = false;\n    }\n  }\n\n  private sort_boxes() {\n    const original_order = this.boxes.map((box) => box.area());\n    const sizes = this.boxes.map((box) => box.area());\n    sizes.sort((a, b) => b - a);\n\n    let z = 0;\n    for (const s of sizes) {\n      this.boxes[original_order.indexOf(s)].setZIndex(z.toString());\n      z++;\n    }\n  }\n\n  select_label(label: string) {\n    const radio: HTMLFormElement = this.display_element.querySelector(`input[value='${label}']`);\n    if (radio) {\n      radio.checked = true;\n    } else {\n      const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n      for (const r of Array.from(radios)) {\n        (r as HTMLFormElement).checked = false;\n      }\n    }\n  }\n\n  private handle_radio_change(e) {\n    this.active_label = (e.target as HTMLFormElement).value;\n    for (const b of this.boxes) {\n      if (b.isSelected()) {\n        b.setLabel(this.active_label);\n      }\n    }\n  }\n\n  private deselect_all(e) {\n    if (this.deselect_all_flag && ![\"RADIO\", \"LABEL\", \"INPUT\"].includes(e.target.tagName)) {\n      for (const b of this.boxes) {\n        b.deselect();\n      }\n    }\n  }\n\n  private add_new_label(e) {\n    const container = this.display_element.querySelector(\"#annotation-options\");\n    const options = container.querySelectorAll('input[type=\"radio\"]').length;\n    const html = `\n      <div><input type=\"radio\" id=\"opt${options + 1}\" name=\"annotate_label\" value=\"\"><label for=\"${\n      options + 1\n    }\"><input id=\"opt${options + 1}_text\" type=\"text\"></label></div>\n    `;\n    container.insertAdjacentHTML(\"beforeend\", html);\n    container\n      .querySelector(`#opt${options + 1}_text`)\n      .addEventListener(\"change\", this.add_new_label);\n    container\n      .querySelector(`#opt${options + 1}_text`)\n      .addEventListener(\"change\", this.update_labels);\n    e.target.removeEventListener(\"change\", this.add_new_label);\n\n    container\n      .querySelector(`#opt${options + 1}`)\n      .addEventListener(\"change\", this.handle_radio_change);\n  }\n\n  private update_labels(e) {\n    const text = e.target as HTMLFormElement;\n    const radio = text.parentElement.parentElement.querySelector(\n      'input[type=\"radio\"]'\n    ) as HTMLFormElement;\n\n    const old_label = radio.value;\n    const new_label = text.value;\n\n    for (const b of this.boxes) {\n      if (b.getLabel() == old_label) {\n        b.setLabel(new_label);\n      }\n    }\n\n    radio.value = new_label;\n  }\n}\n\nclass AnnotationBox {\n  private label = \"?\";\n  private element: HTMLElement;\n  private start_x;\n  private start_y;\n  private end_x;\n  private end_y;\n  private drag_offset_x;\n  private drag_offset_y;\n  private box_list: Array<AnnotationBox>;\n  private container: HTMLElement;\n  private selected = false;\n  private plugin: ImageTextAnnotationPlugin;\n  private modifiable = true;\n\n  constructor(x, y, box_list, container, plugin) {\n    autoBind(this);\n\n    this.container = container;\n    this.box_list = box_list;\n    this.plugin = plugin;\n\n    this.setAnchorCoords(x, y);\n\n    const el = document.createElement(\"div\");\n    el.classList.add(\"annotation-box\", \"modifiable\");\n    el.style.left = `${x}px`;\n    el.style.top = `${y}px`;\n\n    this.element = el;\n\n    this.container.appendChild(this.element);\n  }\n\n  setModifiable(modifiable: boolean) {\n    this.modifiable = modifiable;\n    if (modifiable) {\n      this.element.classList.add(\"modifiable\");\n    } else {\n      this.element.classList.remove(\"modifiable\");\n    }\n  }\n\n  setLabel(label) {\n    if (label) {\n      this.label = label;\n    }\n    this.element.querySelector(\".annotation-box-label\").innerHTML = this.label;\n  }\n\n  getLabel() {\n    return this.label;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  setAnchorCoords(x, y) {\n    this.start_x = x;\n    this.start_y = y;\n  }\n\n  setEndCoords(x, y) {\n    this.end_x = x;\n    this.end_y = y;\n\n    this.updateRenderLocation();\n  }\n\n  translate(x, y) {\n    this.start_x += x;\n    this.start_y += y;\n\n    this.end_x += x;\n    this.end_y += y;\n\n    this.updateRenderLocation();\n  }\n\n  updateRenderLocation() {\n    this.element.style.width = `${Math.abs(this.end_x - this.start_x)}px`;\n    this.element.style.height = `${Math.abs(this.end_y - this.start_y)}px`;\n\n    if (this.start_x <= this.end_x) {\n      this.element.style.left = `${this.start_x}px`;\n    } else {\n      this.element.style.left = `${this.end_x}px`;\n    }\n\n    if (this.start_y <= this.end_y) {\n      this.element.style.top = `${this.start_y}px`;\n    } else {\n      this.element.style.top = `${this.end_y}px`;\n    }\n  }\n\n  finishDrawing() {\n    this.element.innerHTML = `\n      <span class=\"annotation-box-label\"></span>\n      <span class=\"annotation-box-remove\">X</span>\n      <div class=\"annotation-box-resize top left\"></div>\n      <div class=\"annotation-box-resize top right\"></div>\n      <div class=\"annotation-box-resize bottom left\"></div>\n      <div class=\"annotation-box-resize bottom right\"></div>\n    `;\n\n    this.box_list.push(this);\n\n    this.addEvents();\n  }\n\n  addEvents() {\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mousedown\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mouseup\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      this.remove();\n    });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.container.addEventListener(\"mouseup\", () => {\n      this.stopMove();\n    });\n\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"click\", (e) => {\n      e.stopPropagation();\n      this.select();\n    });\n\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"mousedown\", (e) => {\n      if (this.modifiable) {\n        this.startDrag(e);\n      }\n      e.stopPropagation();\n    });\n  }\n\n  startMove() {\n    this.container.addEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  moveHandler(e) {\n    const x = Math.round(e.clientX - this.container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.container.getBoundingClientRect().top);\n\n    this.setEndCoords(x, y);\n  }\n\n  stopMove() {\n    this.container.removeEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  startDrag(e) {\n    this.drag_offset_x =\n      Math.round(e.clientX - this.container.getBoundingClientRect().left) - this.start_x;\n    this.drag_offset_y =\n      Math.round(e.clientY - this.container.getBoundingClientRect().top) - this.start_y;\n\n    this.container.addEventListener(\"mousemove\", this.dragHandler);\n    this.container.addEventListener(\"mouseup\", this.stopDrag);\n  }\n\n  stopDrag() {\n    this.container.removeEventListener(\"mousemove\", this.dragHandler);\n    this.container.removeEventListener(\"mouseup\", this.stopDrag);\n  }\n\n  dragHandler(e) {\n    const x = Math.round(e.clientX - this.container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.container.getBoundingClientRect().top);\n\n    const dx = x - this.drag_offset_x - this.start_x;\n    const dy = y - this.drag_offset_y - this.start_y;\n\n    this.translate(dx, dy);\n  }\n\n  area() {\n    const { width, height } = this.element.getBoundingClientRect();\n    return width * height;\n  }\n\n  setZIndex(z: string) {\n    this.element.style.zIndex = z;\n  }\n\n  remove() {\n    this.element.remove();\n    this.box_list = this.box_list.filter((x) => {\n      x !== this;\n    });\n  }\n\n  select() {\n    for (const b of this.box_list) {\n      b.deselect();\n    }\n    this.selected = true;\n    this.element.querySelector(\".annotation-box-label\").classList.add(\"selected\");\n    this.plugin.select_label(this.label);\n  }\n\n  deselect() {\n    this.selected = false;\n    this.element.querySelector(\".annotation-box-label\").classList.remove(\"selected\");\n  }\n\n  isSelected() {\n    return this.selected;\n  }\n\n  showResizeHandles() {\n    const handles = this.element.querySelectorAll(\".annotation-box-resize\");\n    // for(const h of handles){\n    //   h.style.visibility = 'visible';\n    // }\n  }\n}\n\nexport default ImageTextAnnotationPlugin;\n"],"names":["getAllProperties","object","properties","Set","Reflect","ownKeys","key","add","getPrototypeOf","Object","prototype","info","name","parameters","image","type","ParameterType","IMAGE","default","undefined","prompt","HTML_STRING","regions","COMPLEX","array","ImageTextAnnotationPlugin","constructor","jsPsych","this","trial","display_element","add_css","renderDisplay","addEvents","roi","box","AnnotationBox","left","top","boxes","img_container","setEndCoords","right","bottom","finishDrawing","setLabel","label","setModifiable","html","innerHTML","querySelector","addEventListener","start_box","radios","querySelectorAll","r","Array","from","handle_radio_change","sort_boxes","document","deselect_all_flag","deselect_all","add_new_label","update_labels","insertAdjacentHTML","e","x","Math","round","clientX","getBoundingClientRect","y","clientY","is_drawing","active_box","move_box","stop_box","active_label","select","removeEventListener","original_order","map","area","sizes","sort","a","b","z","s","indexOf","setZIndex","toString","select_label","radio","checked","target","value","isSelected","includes","tagName","deselect","container","options","length","text","parentElement","old_label","new_label","getLabel","box_list","plugin","self","include","exclude","filter","match","pattern","test","some","descriptor","getOwnPropertyDescriptor","bind","autoBind","setAnchorCoords","el","createElement","classList","style","element","appendChild","modifiable","remove","getElement","start_x","start_y","end_x","end_y","updateRenderLocation","translate","width","abs","height","push","stopPropagation","preventDefault","coords","startMove","stopMove","startDrag","moveHandler","drag_offset_x","drag_offset_y","dragHandler","stopDrag","dx","dy","zIndex","selected","showResizeHandles"],"mappings":"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"}
{"version":3,"file":"index.cjs","sources":["../../../node_modules/auto-bind/index.js","../src/index.ts"],"sourcesContent":["'use strict';\n\n// Gets all non-builtin properties up the prototype chain\nconst getAllProperties = object => {\n\tconst properties = new Set();\n\n\tdo {\n\t\tfor (const key of Reflect.ownKeys(object)) {\n\t\t\tproperties.add([object, key]);\n\t\t}\n\t} while ((object = Reflect.getPrototypeOf(object)) && object !== Object.prototype);\n\n\treturn properties;\n};\n\nmodule.exports = (self, {include, exclude} = {}) => {\n\tconst filter = key => {\n\t\tconst match = pattern => typeof pattern === 'string' ? key === pattern : pattern.test(key);\n\n\t\tif (include) {\n\t\t\treturn include.some(match);\n\t\t}\n\n\t\tif (exclude) {\n\t\t\treturn !exclude.some(match);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tfor (const [object, key] of getAllProperties(self.constructor.prototype)) {\n\t\tif (key === 'constructor' || !filter(key)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(object, key);\n\t\tif (descriptor && typeof descriptor.value === 'function') {\n\t\t\tself[key] = self[key].bind(self);\n\t\t}\n\t}\n\n\treturn self;\n};\n","import autoBind from \"auto-bind\";\nimport { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"sketchpad\",\n  parameters: {\n    image: {\n      type: ParameterType.IMAGE,\n      default: undefined,\n    },\n    prompt: {\n      type: ParameterType.HTML_STRING,\n      default: null,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * **image-text-annotaiton**\n *\n * jsPsych plugin for annotating an image with text labels\n *\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/latest/plugins/image-text-annotation/ image-text-annotation plugin documentation on jspsych.org}\n */\nclass ImageTextAnnotationPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n  private img_container: HTMLElement;\n  private is_drawing = false;\n  private active_box: AnnotationBox;\n  private active_label: string;\n  private boxes: Array<AnnotationBox> = [];\n  private display_element: HTMLElement;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    this.display_element = display_element;\n\n    this.add_css();\n    this.renderDisplay(trial);\n    this.addEvents(trial);\n  }\n\n  private renderDisplay(trial) {\n    let html = `<div id=\"jspsych-annotation-display\">`;\n    if (trial.prompt !== null) {\n      html += `<div id='instructions'>${trial.prompt}</div>`;\n    }\n    html += `\n      <div id='main-display'>\n        <div id='annotated-image-container'>\n          <img src=\"${trial.image}\" draggable=\"false\"></img>\n        </div>\n        <div id='annotation-options'>\n          <div><input type=\"radio\" id=\"opt1\" name=\"annotate_label\" value=\"foo\"><label for=\"opt1\">Foo</label></div>\n          <div><input type=\"radio\" id=\"opt2\" name=\"annotate_label\" value=\"bar\"><label for=\"opt2\">Bar</label></div>\n          <div><input type=\"radio\" id=\"opt3\" name=\"annotate_label\" value=\"\"><label for=\"opt3\"><input id=\"opt3_text\" type=\"text\"></label></div>\n        </div>\n      </div>\n    `;\n    html += `</div>`;\n\n    this.display_element.innerHTML = html;\n\n    this.img_container = this.display_element.querySelector(\"#annotated-image-container\");\n  }\n\n  private addEvents(trial) {\n    this.img_container.addEventListener(\"mousedown\", this.start_box);\n\n    const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n    for (const r of Array.from(radios)) {\n      r.addEventListener(\"change\", this.handle_radio_change);\n    }\n\n    this.img_container.addEventListener(\"mousemove\", this.sort_boxes);\n\n    document.addEventListener(\"click\", this.deselect_all);\n\n    this.display_element.querySelector('input[type=\"text\"]').addEventListener('change', this.add_new_label);\n    this.display_element.querySelector('input[type=\"text\"]').addEventListener('change', this.update_labels);\n  }\n\n  private add_css() {\n    document.querySelector(\"head\").insertAdjacentHTML(\n      \"beforeend\",\n      `<style id=\"image-text-annotation-styles\">\n        #jspsych-annotation-display #main-display {\n          display: flex;\n        }\n\n        #jspsych-annotation-display #annotated-image-container {\n          cursor: crosshair;\n          position: relative;\n        }\n\n        #jspsych-annotation-display #annotated-image-container img {\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box {\n          border: 1px solid green;\n          position: absolute;\n          color:green;\n          user-select: none;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover {\n          border: 1px solid yellow;\n          color:yellow;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label {\n          font-size:10px;\n          font-family:monospace;\n          text-align:left;\n          line-height:1em;\n          background-color: rgba(255,255,255,0.5);\n          border-radius: 5px;\n          border: 1px solid green;\n          position:absolute;\n          top:50%;\n          left:50%;\n          transform: translate(-50%,-50%);\n          padding: 0.25em;\n          user-select: none;\n          cursor: pointer;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box .annotation-box-label.selected {\n          font-size:10px;\n          font-family:monospace;\n          text-align:left;\n          line-height:1em;\n          background-color: rgba(255,255,255,0.5);\n          border-radius: 5px;\n          border: 1px solid red;\n          color: red;\n          position:absolute;\n          top:50%;\n          left:50%;\n          transform: translate(-50%,-50%);\n          padding: 0.25em;\n          user-select: none;\n          cursor: pointer;\n        }\n\n        .annotation-box-remove {\n          visibility: hidden;\n          user-select: none;\n          font-size:15px;\n          font-family:monospace;\n          margin:0px;\n          text-align:left;\n          line-height:1em;\n          position: absolute;\n          top:0;\n          right:0;\n          background-color: green;\n          color: white;\n          width:1em;\n          height:1em;\n          text-align: center;\n          cursor: pointer;\n        }\n\n        .annotation-box-resize {\n          visibility: hidden;\n          width: 6px;\n          height: 6px;\n          border-radius: 3px;\n          background-color: green;\n          border: 1px solid white;\n          position: absolute;\n          cursor: pointer;\n          user-select: none;\n        }\n\n        .annotation-box .left {\n          left: -4px;\n        }\n\n        .annotation-box .top {\n          top: -4px;\n        }\n\n        .annotation-box .right {\n          right: -4px;\n        }\n\n        .annotation-box .bottom {\n          bottom: -4px;\n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover .annotation-box-remove {\n          visibility: visible;\n          \n        }\n\n        #jspsych-annotation-display #annotated-image-container .annotation-box:hover .annotation-box-resize {\n          visibility: visible;\n        }\n\n        #jspsych-annotation-display #annotation-options {\n          text-align: left;\n          padding-left: 24px;\n        }\n      </style>`\n    );\n  }\n\n  private start_box(e) {\n    const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n    this.is_drawing = true;\n\n    this.active_box = new AnnotationBox(x, y, this.boxes, this.img_container, this);\n\n    this.img_container.appendChild(this.active_box.getElement());\n\n    this.img_container.addEventListener(\"mousemove\", this.move_box);\n    this.img_container.addEventListener(\"mouseup\", this.stop_box);\n  }\n\n  private move_box(e) {\n    if (this.is_drawing) {\n      const x = Math.round(e.clientX - this.img_container.getBoundingClientRect().left);\n      const y = Math.round(e.clientY - this.img_container.getBoundingClientRect().top);\n\n      this.active_box.setEndCoords(x, y);\n    }\n  }\n\n  private stop_box() {\n    if (this.is_drawing) {\n      this.active_box.finishDrawing();\n\n      this.active_box.setLabel(this.active_label);\n\n      this.active_box = null;\n      this.img_container.removeEventListener(\"mousemove\", this.move_box);\n\n      this.is_drawing = false;\n    }\n  }\n\n  private sort_boxes() {\n    const original_order = this.boxes.map((box) => box.area());\n    const sizes = this.boxes.map((box) => box.area());\n    sizes.sort((a, b) => b - a);\n\n    let z = 0;\n    for (const s of sizes) {\n      this.boxes[original_order.indexOf(s)].setZIndex(z.toString());\n      z++;\n    }\n  }\n\n  select_label(label: string) {\n    const radio: HTMLFormElement = this.display_element.querySelector(`input[value='${label}']`);\n    if (radio) {\n      radio.checked = true;\n    } else {\n      const radios = this.display_element.querySelectorAll('input[type=\"radio\"]');\n      for (const r of Array.from(radios)) {\n        (r as HTMLFormElement).checked = false;\n      }\n    }\n  }\n\n  private handle_radio_change(e) {\n    this.active_label = (e.target as HTMLFormElement).value;\n    for (const b of this.boxes) {\n      if (b.isSelected()) {\n        b.setLabel(this.active_label);\n      }\n    }\n  }\n\n  private deselect_all(e) {\n    if (![\"RADIO\", \"LABEL\", \"INPUT\"].includes(e.target.tagName)) {\n      for (const b of this.boxes) {\n        b.deselect();\n      }\n    }\n  }\n\n  private add_new_label(e){\n    const container = this.display_element.querySelector('#annotation-options');\n    const options = container.querySelectorAll('input[type=\"radio\"]').length;\n    const html = `\n      <div><input type=\"radio\" id=\"opt${options+1}\" name=\"annotate_label\" value=\"\"><label for=\"${options+1}\"><input id=\"opt${options+1}_text\" type=\"text\"></label></div>\n    `\n    container.insertAdjacentHTML('beforeend', html);\n    container.querySelector(`#opt${options+1}_text`).addEventListener('change', this.add_new_label);\n    container.querySelector(`#opt${options+1}_text`).addEventListener('change', this.update_labels);\n    e.target.removeEventListener('change', this.add_new_label);\n\n    container.querySelector(`#opt${options+1}`).addEventListener(\"change\", this.handle_radio_change);\n  }\n\n  private update_labels(e){\n    const text = e.target as HTMLFormElement;\n    const radio = text.parentElement.parentElement.querySelector('input[type=\"radio\"]') as HTMLFormElement;\n\n    const old_label = radio.value;\n    const new_label = text.value;\n\n    for(const b of this.boxes){\n      if(b.getLabel() == old_label){\n        b.setLabel(new_label);\n      }\n    }\n\n    radio.value = new_label;\n  }\n}\n\nclass AnnotationBox {\n  private label = \"?\";\n  private element: HTMLElement;\n  private start_x;\n  private start_y;\n  private end_x;\n  private end_y;\n  private box_list: Array<AnnotationBox>;\n  private container: HTMLElement;\n  private selected = false;\n  private plugin: ImageTextAnnotationPlugin;\n\n  constructor(x, y, box_list, container, plugin) {\n    autoBind(this);\n\n    this.container = container;\n    this.box_list = box_list;\n    this.plugin = plugin;\n\n    this.setAnchorCoords(x, y);\n\n    const el = document.createElement(\"div\");\n    el.setAttribute(\"class\", \"annotation-box\");\n    el.style.left = `${x}px`;\n    el.style.top = `${y}px`;\n\n    this.element = el;\n  }\n\n  setLabel(label) {\n    if (label) {\n      this.label = label;\n    }\n    this.element.querySelector(\".annotation-box-label\").innerHTML = this.label;\n  }\n\n  getLabel() {\n    return this.label;\n  }\n\n  getElement() {\n    return this.element;\n  }\n\n  setAnchorCoords(x, y) {\n    this.start_x = x;\n    this.start_y = y;\n  }\n\n  setEndCoords(x, y) {\n    this.end_x = x;\n    this.end_y = y;\n\n    this.element.style.width = `${Math.abs(this.end_x - this.start_x)}px`;\n    this.element.style.height = `${Math.abs(this.end_y - this.start_y)}px`;\n\n    if (this.start_x <= this.end_x) {\n      this.element.style.left = `${this.start_x}px`;\n    } else {\n      this.element.style.left = `${this.end_x}px`;\n    }\n\n    if (this.start_y <= this.end_y) {\n      this.element.style.top = `${this.start_y}px`;\n    } else {\n      this.element.style.top = `${this.end_y}px`;\n    }\n  }\n\n  finishDrawing() {\n    this.element.innerHTML = `\n      <span class=\"annotation-box-label\"></span>\n      <span class=\"annotation-box-remove\">X</span>\n      <div class=\"annotation-box-resize top left\"></div>\n      <div class=\"annotation-box-resize top right\"></div>\n      <div class=\"annotation-box-resize bottom left\"></div>\n      <div class=\"annotation-box-resize bottom right\"></div>\n    `;\n\n    this.box_list.push(this);\n\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mousedown\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"mouseup\", (e) => {\n      e.stopPropagation();\n    });\n    this.element.querySelector(\".annotation-box-remove\").addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      this.remove();\n    });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.bottom.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.top - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.right\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.left - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.element\n      .querySelector(\".annotation-box-resize.top.left\")\n      .addEventListener(\"mousedown\", (e) => {\n        const coords = this.element.getBoundingClientRect();\n        const container = this.container.getBoundingClientRect();\n        this.setAnchorCoords(coords.right - container.left, coords.bottom - container.top);\n        e.stopPropagation();\n        this.startMove();\n      });\n\n    this.container.addEventListener(\"mouseup\", () => {\n      this.stopMove();\n    });\n\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"click\", this.select);\n    this.element.querySelector(\".annotation-box-label\").addEventListener(\"mousedown\", (e) => {\n      e.stopPropagation();\n    });\n  }\n\n  startMove() {\n    this.container.addEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  moveHandler(e) {\n    const x = Math.round(e.clientX - this.container.getBoundingClientRect().left);\n    const y = Math.round(e.clientY - this.container.getBoundingClientRect().top);\n\n    this.setEndCoords(x, y);\n  }\n\n  stopMove() {\n    this.container.removeEventListener(\"mousemove\", this.moveHandler);\n  }\n\n  area() {\n    const { width, height } = this.element.getBoundingClientRect();\n    return width * height;\n  }\n\n  setZIndex(z: string) {\n    this.element.style.zIndex = z;\n  }\n\n  remove() {\n    this.element.remove();\n    this.box_list = this.box_list.filter((x) => {\n      x !== this;\n    });\n  }\n\n  select(e: Event) {\n    e.stopPropagation();\n    for (const b of this.box_list) {\n      b.deselect();\n    }\n    this.selected = true;\n    this.element.querySelector(\".annotation-box-label\").classList.add(\"selected\");\n    this.plugin.select_label(this.label);\n  }\n\n  deselect() {\n    this.selected = false;\n    this.element.querySelector(\".annotation-box-label\").classList.remove(\"selected\");\n  }\n\n  isSelected() {\n    return this.selected;\n  }\n\n  showResizeHandles() {\n    const handles = this.element.querySelectorAll(\".annotation-box-resize\");\n    // for(const h of handles){\n    //   h.style.visibility = 'visible';\n    // }\n  }\n}\n\nexport default ImageTextAnnotationPlugin;\n"],"names":["ParameterType"],"mappings":"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"}